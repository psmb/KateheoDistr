include: Redirect.ts2
include: OverrideStock.ts2
include: NodeTypes/**/*.ts2

prototype(Sfi.Kateheo:SectionMenu) < prototype(TYPO3.Neos:Menu) {
	templatePath = 'resource://Sfi.Kateheo/Private/Templates/TypoScriptObjects/2levelMenu.html'
	innerAttributes = Neos.Fusion:Attributes {
		class = 'innerLevel'
	}
	entryLevel = 2
	maximumLevels = 2
	filter = '!My.Site:News,Sfi.Kateheo:Category'
	attributes.class = "nav nav-list bs-docs-sidenav affix-top"
	current.attributes.class = "active"
}

#This is a default page object. It's being extended and never used directly.
prototype(Sfi.Kateheo:Page) >
prototype(Sfi.Kateheo:Page) < prototype(TYPO3.Neos:Page) {
	head {
		titleTag.content = ${String.stripTags(q(node).property('title'))}
		stylesheets.site = Neos.Fusion:Template {
			templatePath = 'resource://Sfi.Kateheo/Private/Partials/SharedResources.html'
			sectionName = 'stylesheets'
		}
		javascripts.headScripts = Neos.Fusion:Template {
			templatePath = 'resource://Sfi.Kateheo/Private/Partials/SharedResources.html'
			sectionName = 'headScripts'
		}
	}
	htmlTag.attributes.lang="ru"
	bodyTag.attributes.class = 'Page'
	bodyTag.attributes.id = ${'Page-' + q(node).property('_name')}
	body {
		templatePath = 'resource://Sfi.Kateheo/Private/Templates/Pages/Page.html'
		partialRootPath = 'resource://Sfi.Kateheo/Private/Partials'

		mainMenu = Menu {
			entryLevel = 1
			maximumLevels = 1
			attributes.class = "nav"
		}

		@context.sectionMenu = Sfi.Kateheo:SectionMenu

		main = PrimaryContent {
			renderByType {
				condition = TRUE
				type = ${q(node).property('_nodeType.name')}
			}
		}

		javascripts.bodyScripts = Neos.Fusion:Template {
			templatePath = 'resource://Sfi.Kateheo/Private/Partials/SharedResources.html'
			partialRootPath = 'resource://Sfi.Kateheo/Private/Partials'
			sectionName = 'bodyScripts'
		}
	}
}

root.fallbackPage {
	@position = 'before default'
	condition = TRUE
	type = 'Sfi.Kateheo:Page'
}

# Disable stupid layout mechanism
root.layout>

#Needed for listable-paginate widget to work
prototype(Sfi.Kateheo:Page).@cache.entryIdentifier.pagination = ${request.pluginArguments.listable-paginate.currentPage}
root.@cache.entryIdentifier.pagination = ${request.pluginArguments.listable-paginate.currentPage}
